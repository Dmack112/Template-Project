!function(e){function t(t){for(var r,a,s=t[0],l=t[1],u=t[2],c=0,f=[];c<s.length;c++)a=s[c],i[a]&&f.push(i[a][0]),i[a]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(d&&d(t);f.length;)f.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,s=1;s<n.length;s++){var l=n[s];0!==i[l]&&(r=!1)}r&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},i={3:0},o=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var d=l;o.push([359,0,9]),n()}({135:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.setModalAsMinimized=function(){sessionStorage.setItem(this.sessionStorage_modalIsMinimised,"minimized")},e.setModalAsUnminimized=function(){sessionStorage.setItem(this.sessionStorage_modalIsMinimised,"unminimized")},e.getIfModalIsMinimized=function(){var e=!1,t=sessionStorage.getItem(this.sessionStorage_modalIsMinimised);return void 0!==t&&(e="minimized"===t),e},e.getLiveAlertIDs=function(){var e=sessionStorage.getItem(this.sessionStorage_liveAlertIDs);return e?e.split(","):[]},e.setLiveAlertIDs=function(e){sessionStorage.setItem(this.sessionStorage_liveAlertIDs,e.join(","))},e.getAlertIDsAlreadySeen=function(){var e=sessionStorage.getItem(this.sessionStorage_alertIDsAlreadySeen);return e?e.split(","):[]},e.setAlertIDsAlreadySeen=function(e){sessionStorage.setItem(this.sessionStorage_alertIDsAlreadySeen,e.join(","))},e.getNumAjaxRequests=function(){var e=sessionStorage.getItem(this.sessionStorage_numAjaxRequests);return e?parseInt(e,10):0},e.incrementNumAjaxRequests=function(){var e=this.getNumAjaxRequests();e+=1,this.setNumAjaxRequests(e)},e.decrementNumAjaxRequests=function(){var e=this.getNumAjaxRequests();e-=1,this.setNumAjaxRequests(e)},e.setNumAjaxRequests=function(e){sessionStorage.setItem(this.sessionStorage_numAjaxRequests,e.toString())},e.sessionStorage_modalIsMinimised="modalIsMinimised",e.sessionStorage_liveAlertIDs="liveAlertIDs",e.sessionStorage_alertIDsAlreadySeen="alertIDsAlreadySeen",e.sessionStorage_numAjaxRequests="numAjaxRequests",e}();t.SessionStorage=r},14:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.environment="PROD",this.staffDirServiceURL="../Common/controls/StaffDirectory/ws/StaffDirectoryWS.asmx/",this.calendarServiceURL="../Common/controls/WorkspaceCalendar/ws/WorkspaceCalendarWS.asmx/",this.unifiedPublishingAlertURL="../WebServices/UnifiedPublishing/UnifiedPublishingService.asmx/",this.emailPopupPath="../common/controls/General/Email/Default.aspx?action=staffDirectoryEmail&recipients="}}();t.EnviroConfig=r},3:function(e,t){e.exports=jQuery},359:function(e,t,n){"use strict";var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},i=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(44);var o=r(n(0)),a=r(n(22)),s=n(45),l=i(n(360));for(var u=document.getElementsByClassName("unifiedPublishingAlertComponent"),d=function(e){var t=u[e],n=t.attributes["data-portlet-instance-id"].nodeValue;!function(e){a.render(o.createElement(s.AppContainer,null,o.createElement(e,{portletInstanceId:n})),t)}(l.default)},c=0;c<u.length;c++)d(c)},360:function(e,t,n){"use strict";var r=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},o=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(33);var a=i(n(0)),s=o(n(361)),l=n(362),u=n(363),d=n(364),c=n(82),f=n(365),m=n(369),p=n(135);n(48),n(83);var v=function(e){function t(t){var n=e.call(this,t)||this;return n.setInitialState(),n.dataService=new l.DataService,n.onMinimizeModal=n.onMinimizeModal.bind(n),n.onUnminimizeModal=n.onUnminimizeModal.bind(n),n}return r(t,e),t.prototype.componentDidMount=function(){this.loadLiveAlerts()},t.prototype.onMinimizeModal=function(e){e.preventDefault(),p.SessionStorage.setModalAsMinimized(),this.setState({modalIsMinimized:!0})},t.prototype.onUnminimizeModal=function(e){e.preventDefault(),this.loadLiveAlerts(!0),p.SessionStorage.setModalAsUnminimized(),this.setState({modalIsMinimized:!1})},t.prototype.render=function(){var e=this.state.displayModal&&!this.state.modalIsMinimized;return a.createElement(a.Fragment,null,a.createElement(c.ModalHtmlClassHack,{modalIsOpen:e}),e&&a.createElement(f.UnifiedPublishingModal,{displayModal:this.state.displayModal,liveAlerts:this.state.liveAlerts,modalIsMinimized:this.state.modalIsMinimized,numAjaxRequests:this.state.numAjaxRequests,text:this.state.text,onMinimizeModal:this.onMinimizeModal}),a.createElement(m.UnifiedPublishingUnminimizeButton,{displayModal:this.state.displayModal,modalIsMinimized:this.state.modalIsMinimized,numAlerts:this.state.liveAlerts.length,text:this.state.text,onUnminimizeModal:this.onUnminimizeModal}))},t.prototype.setInitialState=function(){var e=this.getBlankInternationalizedText(),t=p.SessionStorage.getIfModalIsMinimized(),n=p.SessionStorage.getNumAjaxRequests();this.state={error:"",liveAlerts:[],displayModal:!1,modalIsMinimized:t,numAjaxRequests:n,text:e}},t.prototype.getBlankInternationalizedText=function(){return{alerts:"",errorsHaveOccurred:"",loading:"",minimize:"",new:" ",noAlerts:"",noAlertsDescription:""}},t.prototype.loadLiveAlerts=function(e){var t=this;void 0===e&&(e=!1),this.addOneAJAXCallToCount();this.dataService.fetchWithTimeoutRace("GetActiveAlerts").then(function(e){return t.dataService.handleResponseErrors(e,"GetActiveAlerts")}).then(function(e){return t.subtractOneAJAXCallFromCount(),e.json()}).then(function(n){t.handleReturnedAlerts(n,e)}).catch(function(e){t.addError(e.message),t.subtractOneAJAXCallFromCount()})},t.prototype.handleReturnedAlerts=function(e,t){void 0!==e.d&&(e=e.d);for(var n=this.convertToIAlert(e),r=[],i=0,o=n;i<o.length;i++){var a=o[i];r.push(a.alertId)}var l=p.SessionStorage.getLiveAlertIDs();l.length>0?s.default(r,l).length>0&&this.setState({modalIsMinimized:!1}):n.length>0&&this.setState({modalIsMinimized:!1}),p.SessionStorage.setLiveAlertIDs(r);var u=!0;t||(u=n.length>0),!t&&n.length>0&&this.loadInternationalizedText(),this.setState({liveAlerts:n,displayModal:u})},t.prototype.convertToIAlert=function(e){var t=[];if(!Array.isArray(e))throw new Error("Alerts response is not an array.");for(var n=0,r=e;n<r.length;n++){var i=r[n];if(!u.isIAlertResponse(i))throw new Error("Alert data for an alert is not valid, missing expected fields.");var o={alertId:i.AlertId,alertType:i.AlertType,body:i.Body,expiryDate:new Date(i.Expiry),title:i.Title};t.push(o)}return t},t.prototype.loadInternationalizedText=function(){var e=this;this.addOneAJAXCallToCount();this.dataService.fetchWithTimeoutRace("GetInternationalizedText").then(function(t){return e.dataService.handleResponseErrors(t,"GetInternationalizedText")}).then(function(t){return e.subtractOneAJAXCallFromCount(),t.json()}).then(function(t){if(void 0!==t.d&&(t=t.d),d.isIText(t)){var n=t;e.setState({text:n})}else e.addError("Internationalised text data returned by service is incomplete.")}).catch(function(t){e.addError(t.message),e.subtractOneAJAXCallFromCount()})},t.prototype.addOneAJAXCallToCount=function(){p.SessionStorage.incrementNumAjaxRequests(),this.setState({numAjaxRequests:p.SessionStorage.getNumAjaxRequests()})},t.prototype.subtractOneAJAXCallFromCount=function(){p.SessionStorage.decrementNumAjaxRequests(),this.setState({numAjaxRequests:p.SessionStorage.getNumAjaxRequests()})},t.prototype.addError=function(e){this.setState({error:e})},t}(a.Component);t.default=v},362:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),n(33);var r=n(14),i=function(){function t(){}return t.prototype.fetchWithTimeoutRace=function(t){var n=new Headers;n.append("Accept","application/json, text/javascript, */*; q=0.01"),n.append("Content-Type","application/json; charset=UTF-8");var i=(new r.EnviroConfig).unifiedPublishingAlertURL;return e.race([fetch(i+t,{method:"POST",headers:n,body:"",credentials:"same-origin"}),new e(function(e,n){return setTimeout(function(){return n(new Error("The request to the service for "+t+" timed out."))},1e4)})])},t.prototype.handleResponseErrors=function(e,t){if(!e.ok)throw Error(t+" service: "+e.statusText);return e},t}();t.DataService=i}).call(this,n(46))},363:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isIAlertResponse=function(e){return void 0!==e.AlertId&&(void 0!==e.Title&&(void 0!==e.Body&&(void 0!==e.AlertType&&void 0!==e.Expiry)))}},364:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isIText=function(e){return void 0!==e.alerts&&(void 0!==e.errorsHaveOccurred&&(void 0!==e.loading&&(void 0!==e.minimize&&(void 0!==e.new&&(void 0!==e.noAlerts&&void 0!==e.noAlertsDescription)))))}},365:function(e,t,n){"use strict";var r=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},o=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(0)),s=o(n(68)),l=n(366),u=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.parentElementSelector="body",r}return r(t,e),t.prototype.componentDidMount=function(){s.default.setAppElement(this.parentElementSelector)},t.prototype.render=function(){var e=this,t=this.props;return t.displayModal&&!t.modalIsMinimized?a.createElement(a.Fragment,null,a.createElement(s.default,{isOpen:t.displayModal,parentSelector:function(){return document.querySelector(e.parentElementSelector)},className:"ReactModal__Content ReactModal__Content--after-open ReactModal__Content",overlayClassName:"ReactModal__Overlay ReactModal__Overlay--after-open ReactModal__Overlay CMS_PF_dialog CMS_PF_react CMS_react_ScrollingDialog",shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,onRequestClose:t.onMinimizeModal},a.createElement(l.UnifiedPublishingModalContent,{liveAlerts:this.props.liveAlerts,numAjaxRequests:this.props.numAjaxRequests,text:this.props.text,onClickCloseModalButton:t.onMinimizeModal}))):null},t}(a.Component);t.UnifiedPublishingModal=u},366:function(e,t,n){"use strict";var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),o=n(81),a=n(367),s=n(368);t.UnifiedPublishingModalContent=function(e){var t=null,n=!1,r=e.numAjaxRequests>0;return 0===e.numAjaxRequests&&" "!==e.text.new&&(n=0===(t=e.liveAlerts.map(function(t){return i.createElement(a.UnifiedPublishingLiveAlertDetail,{alert:t,text:e.text,key:t.alertId})})).length),i.createElement(i.Fragment,null,i.createElement("a",{className:"CMS_dialogClose CMS_dialogMinimize CMS_button CMS_bSquare",href:"#",onClick:e.onClickCloseModalButton},i.createElement("em",{className:"fa fa-window-minimize","aria-hidden":"true"}),i.createElement("span",{className:"offScreen"},e.text.minimize)),i.createElement("div",{className:"CMS_element"},i.createElement("div",{className:"CMS_title CMS_T4"},i.createElement("em",{className:"fa fa-exclamation-triangle"})," ",e.text.alerts),i.createElement("div",{className:"CMS_e_row CMS_minimumHeight"},i.createElement(o.LoadingSpinner,{showSpinner:r,loadingText:e.text.loading}),t,n&&i.createElement(s.UnifiedPublishingNoAlertsDetail,{text:e.text}))))}},367:function(e,t,n){"use strict";var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),o=n(135);t.UnifiedPublishingLiveAlertDetail=function(e){var t=!0,n=o.SessionStorage.getAlertIDsAlreadySeen();-1!==n.indexOf(e.alert.alertId)&&(t=!1),t&&(n.push(e.alert.alertId),o.SessionStorage.setAlertIDsAlreadySeen(n));var r="A_alert",a=!1;return t&&(r+=" A_new",a=!0),i.createElement("div",{className:r},i.createElement("div",{className:"A_title"},a&&i.createElement(i.Fragment,null,i.createElement("span",null,i.createElement("em",{className:"fa fa-star"})," ",e.text.new)," "),e.alert.title),i.createElement("div",{className:"A_content",dangerouslySetInnerHTML:{__html:""+e.alert.body}}))}},368:function(e,t,n){"use strict";var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0));t.UnifiedPublishingNoAlertsDetail=function(e){return i.createElement("div",{className:"A_alert A_expired"},i.createElement("div",{className:"A_title"},e.text.noAlerts),i.createElement("div",{className:"A_content"},e.text.noAlertsDescription))}},369:function(e,t,n){"use strict";var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0));t.UnifiedPublishingUnminimizeButton=function(e){if(e.displayModal&&e.numAlerts>0){var t="A_maximizeButton";e.displayModal&&e.modalIsMinimized&&(t+=" A_mbVisible");var n="";return e.text&&(n=e.text.alerts),i.createElement("button",{onClick:e.onUnminimizeModal,className:t},i.createElement("em",{className:"fa fa-exclamation-triangle","aria-hidden":"true"})," ",n," ",i.createElement("span",null,e.numAlerts))}return null}},47:function(e,t){},81:function(e,t,n){"use strict";var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0));t.LoadingSpinner=function(e){return e.showSpinner?i.createElement("div",{className:"CMS_loadingSpinner",title:e.loadingText,"aria-hidden":"true"},i.createElement("div",{className:"CMS_ls_spin"})):null}},82:function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(3));t.ModalHtmlClassHack=function(e){return e.modalIsOpen?i.default("html").addClass("CMS_PF_dialog_open"):i.default("html").removeClass("CMS_PF_dialog_open"),null}},83:function(e,t){}});
//# sourceMappingURL=react_upAlert.js.map